# Continue Session: Verify perplexity_deep_research Tool

## Context

Just added `perplexity_deep_research` tool to the local Perplexity MCP server at `~/Projects/Programs/perplexity-api-simple/mcp-server/index.js`.

**Changes Made:**
1. Added tool definition in `ListToolsRequestSchema` (lines 171-187)
2. Added handler in `CallToolRequestSchema` (lines 227-239)
3. Version bumped: 2.0.0 → 2.1.0
4. Updated CLAUDE.md files to use new tool

**Files Modified:**
- `~/Projects/Programs/perplexity-api-simple/mcp-server/index.js`
- `~/.claude/CLAUDE.md`
- `/home/anombyte/Atlas/Atlas_Website/CLAUDE.md`

---

## Tasks for Next Session

### 1. Verify Tool is Available

```bash
# Check if the new tool is listed
mcp-cli tools | grep perplexity_deep_research

# Expected output:
# mcp-router/perplexity-api-free_perplexity_deep_research
```

### 2. Test the Tool

```bash
# Test with a simple query
mcp-cli call mcp-router/perplexity-api-free_perplexity_deep_research '{
  "query": "What are the latest developments in MCP servers and Model Context Protocol in 2025?"
}'
```

### 3. Compare Tool Outputs

Run all three tools in parallel to compare depth/quality:

```bash
# Fast (auto mode)
mcp-cli call mcp-router/perplexity-api-free_perplexity_search '{
  "query": "same query",
  "mode": "auto"
}' > /tmp/perplexity_auto.json &

# Pro mode
mcp-cli call mcp-router/perplexity-api-free_perplexity_pro_search '{
  "query": "same query"
}' > /tmp/perplexity_pro.json &

# Deep research (NEW)
mcp-cli call mcp-router/perplexity-api-free_perplexity_deep_research '{
  "query": "same query"
}' > /tmp/perplexity_deep.json &

wait

# Compare output sizes
wc -l /tmp/perplexity_*.json
```

### 4. Update Documentation (if tool works)

If verification succeeds, the following are already updated:
- ✅ `~/.claude/CLAUDE.md` - Uses `perplexity_deep_research`
- ✅ `/home/anombyte/Atlas/Atlas_Website/CLAUDE.md` - Uses `perplexity_deep_research`

### 5. Optional: Add Convenience Aliases

Consider adding shell aliases for quick research:

```bash
# Add to ~/.zshrc or ~/.bashrc
alias presearch='mcp-cli call mcp-router/perplexity-api-free_perplexity_deep_research'
alias prosearch='mcp-cli call mcp-router/perplexity-api-free/perplexity_pro_search'
alias quicksearch='mcp-cli call mcp-router/perplexity-api-free/perplexity_search'
```

---

## Expected Results

| Tool | Duration | Sources | Use Case |
|------|----------|---------|----------|
| `perplexity_search` (auto) | ~5s | 5-10 | Quick answers |
| `perplexity_pro_search` | ~10-15s | 20-50 | Complex queries |
| `perplexity_deep_research` | ~2-5 min | 100+ | Comprehensive analysis |

---

## Troubleshooting

**If tool not found:**
```bash
# Restart Claude sessions
# MCP server spawns fresh on each mcp-cli call
# But persistent clients (Claude Desktop) need restart
```

**If timeout occurs:**
```bash
# Check backend API health
curl -s http://localhost:8765/health | jq .

# Should show: {"status": "ok", "cookie_loaded": true}
```

---

## Session Prompt (Copy This)

```
Continue verifying the perplexity_deep_research tool implementation.

Check:
1. mcp-cli tools | grep perplexity_deep_research
2. Test the tool with a query
3. Compare outputs from all three Perplexity tools

Context in: .continue-session.md
```
